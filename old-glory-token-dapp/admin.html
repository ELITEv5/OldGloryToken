<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OGT+ Owner Dashboard</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #1e3c72;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .wallet-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #1e3c72;
            word-break: break-all;
        }

        .connect-btn {
            background: #1e3c72;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .connect-btn:hover {
            background: #2a5298;
            transform: translateY(-2px);
        }

        .connect-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .help-text {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .fee-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button.action-btn {
            width: 100%;
            background: #1e3c72;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            margin-top: 10px;
        }

        button.action-btn:hover:not(:disabled) {
            background: #2a5298;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }

        button.action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        button.danger-btn {
            background: #dc3545;
        }

        button.danger-btn:hover:not(:disabled) {
            background: #c82333;
        }

        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.95em;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .danger-zone {
            border: 2px solid #dc3545;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .danger-zone h3 {
            color: #dc3545;
            margin-bottom: 15px;
        }

        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .warning-box ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .warning-box li {
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .fee-grid {
                grid-template-columns: 1fr;
            }

            .wallet-info {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .current-values {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .current-values h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .value-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .value-item:last-child {
            border-bottom: none;
        }

        .value-label {
            color: #666;
        }

        .value-data {
            font-weight: 600;
            color: #1e3c72;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üá∫üá∏ Old Glory Token (OGT+) Owner Dashboard</h1>
            <p class="subtitle">Manage your token parameters before renouncing ownership</p>
        </div>

        <div class="wallet-section">
            <div class="wallet-info">
                <div class="info-item">
                    <span class="info-label">Connected Wallet</span>
                    <span class="info-value" id="walletAddress">Not connected</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Contract Owner</span>
                    <span class="info-value" id="contractOwner">Loading...</span>
                </div>
                <button class="connect-btn" id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
            </div>
        </div>

        <div class="grid">
            <!-- Fee Management -->
            <div class="card">
                <h2>üí∞ Fee Management</h2>
                <div class="current-values">
                    <h4>Current Fees</h4>
                    <div class="value-item">
                        <span class="value-label">Buy Burn:</span>
                        <span class="value-data" id="currentBuyBurn">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Buy Yield:</span>
                        <span class="value-data" id="currentBuyYield">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Sell Burn:</span>
                        <span class="value-data" id="currentSellBurn">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Sell Yield:</span>
                        <span class="value-data" id="currentSellYield">-</span>
                    </div>
                </div>
                
                <div class="fee-grid">
                    <div class="form-group">
                        <label>Buy Burn Fee (bps)</label>
                        <input type="number" id="buyBurnFee" value="10" min="0" max="500">
                        <div class="help-text">Fee burned on buys (10 = 0.1%)</div>
                    </div>
                    <div class="form-group">
                        <label>Buy Yield Fee (bps)</label>
                        <input type="number" id="buyYieldFee" value="35" min="0" max="500">
                        <div class="help-text">Fee for rewards on buys (35 = 0.35%)</div>
                    </div>
                    <div class="form-group">
                        <label>Sell Burn Fee (bps)</label>
                        <input type="number" id="sellBurnFee" value="100" min="0" max="500">
                        <div class="help-text">Fee burned on sells (100 = 1%)</div>
                    </div>
                    <div class="form-group">
                        <label>Sell Yield Fee (bps)</label>
                        <input type="number" id="sellYieldFee" value="300" min="0" max="500">
                        <div class="help-text">Fee for rewards on sells (300 = 3%)</div>
                    </div>
                </div>
                <button class="action-btn" onclick="setFees()">Update Fees</button>
                <div id="feesStatus"></div>
            </div>

            <!-- Payout Policy -->
            <div class="card">
                <h2>‚öôÔ∏è Payout Policy</h2>
                <div class="current-values">
                    <h4>Current Settings</h4>
                    <div class="value-item">
                        <span class="value-label">Payout Enabled:</span>
                        <span class="value-data" id="currentPayoutEnabled">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Min Wait Time:</span>
                        <span class="value-data" id="currentMinWait">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Min Yield:</span>
                        <span class="value-data" id="currentMinYield">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Max Payout:</span>
                        <span class="value-data" id="currentMaxPayout">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Max Gas:</span>
                        <span class="value-data" id="currentMaxGas">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="payoutEnabled" checked>
                        <label>Enable Automatic Payouts</label>
                    </div>
                    <div class="help-text">Allow automatic yield distribution during transfers</div>
                </div>

                <div class="form-group">
                    <label>Minimum Wait Time (seconds)</label>
                    <input type="number" id="minWaitSec" value="3600" min="1800">
                    <div class="help-text">Minimum time between claims (3600 = 1 hour, min 1800)</div>
                </div>

                <div class="form-group">
                    <label>Minimum Yield (pSunDAI)</label>
                    <input type="number" id="minYield" value="0.369" step="0.001" min="1">
                    <div class="help-text">Minimum yield before payout (must be ‚â• 1 pSunDAI)</div>
                </div>

                <div class="form-group">
                    <label>Maximum Payout (pSunDAI)</label>
                    <input type="number" id="maxPayout" value="5000" min="100">
                    <div class="help-text">Maximum single payout amount (must be ‚â• 100x min)</div>
                </div>

                <div class="form-group">
                    <label>Max Gas per Payout</label>
                    <input type="number" id="maxGas" value="300000" min="50000" max="500000">
                    <div class="help-text">Gas limit for payout operations (max 500,000)</div>
                </div>

                <button class="action-btn" onclick="setPayoutPolicy()">Update Payout Policy</button>
                <div id="payoutStatus"></div>
            </div>

            <!-- Swap Configuration -->
            <div class="card">
                <h2>üîÑ Swap Configuration</h2>
                <div class="current-values">
                    <h4>Current Settings</h4>
                    <div class="value-item">
                        <span class="value-label">Swap Enabled:</span>
                        <span class="value-data" id="currentSwapEnabled">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">LP Factor:</span>
                        <span class="value-data" id="currentLpFactor">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Slippage:</span>
                        <span class="value-data" id="currentSlippage">-</span>
                    </div>
                    <div class="value-item">
                        <span class="value-label">Auto Payout:</span>
                        <span class="value-data" id="currentAutoPayout">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="swapEnabled" checked>
                        <label>Enable Token Swaps</label>
                    </div>
                    <div class="help-text">Allow OGT+ ‚Üí WPLS ‚Üí pSunDAI swaps for rewards</div>
                </div>

                <div class="form-group">
                    <label>LP Factor</label>
                    <input type="number" id="lpFactor" value="2000" min="50" max="200000">
                    <div class="help-text">Swap size divisor (2000 = swap 1/2000 of LP balance)</div>
                </div>

                <div class="form-group">
                    <label>Slippage Tolerance (bps)</label>
                    <input type="number" id="slippage" value="200" min="10" max="500">
                    <div class="help-text">Max slippage for swaps (200 = 2%, max 5%)</div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoPayout" checked>
                        <label>Enable Auto Payout</label>
                    </div>
                    <div class="help-text">Automatically process payouts during transfers</div>
                </div>

                <button class="action-btn" onclick="setSwapParams()">Update Swap Settings</button>
                <button class="action-btn" onclick="setSlippage()" style="margin-top: 10px;">Update Slippage</button>
                <button class="action-btn" onclick="setAutoPayout()" style="margin-top: 10px;">Toggle Auto Payout</button>
                <div id="swapStatus"></div>
            </div>

            <!-- Yield Exclusions -->
            <div class="card">
                <h2>üö´ Yield Exclusions</h2>
                <p style="margin-bottom: 15px; color: #666;">
                    Exclude addresses from earning pSunDAI yield (e.g., treasury wallets, contracts)
                </p>

                <div class="form-group">
                    <label>Address to Exclude/Include</label>
                    <input type="text" id="excludeAddress" placeholder="0x...">
                    <div class="help-text">Enter wallet address to toggle yield eligibility</div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="excludeFlag" checked>
                        <label>Exclude from Yield</label>
                    </div>
                    <div class="help-text">Checked = exclude, Unchecked = include</div>
                </div>

                <button class="action-btn" onclick="setNoYield()">Update Yield Exclusion</button>
                <div id="excludeStatus"></div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="card danger-zone">
            <h3>‚ö†Ô∏è DANGER ZONE</h3>
            
            <div class="warning-box">
                <strong>‚ö†Ô∏è Warning: Ownership Renunciation is PERMANENT</strong>
                <p>Once you renounce ownership, you will <strong>NEVER</strong> be able to:</p>
                <ul>
                    <li>Change fees</li>
                    <li>Modify payout policy</li>
                    <li>Update swap parameters</li>
                    <li>Exclude addresses from yield</li>
                    <li>Transfer ownership to anyone else</li>
                </ul>
                <p style="margin-top: 10px;">
                    <strong>The contract becomes truly immutable and autonomous.</strong>
                    Only renounce when you're 100% satisfied with all settings.
                </p>
            </div>

            <div class="form-group">
                <label>Transfer Ownership To (optional first step)</label>
                <input type="text" id="newOwner" placeholder="0x... (new owner address)">
                <div class="help-text">Transfer ownership before renouncing if needed</div>
            </div>
            <button class="action-btn" onclick="transferOwnership()">Transfer Ownership</button>

            <div style="margin-top: 30px;">
                <p style="color: #dc3545; font-weight: 600; margin-bottom: 15px;">
                    Final Step: Renounce Ownership (Cannot be undone!)
                </p>
                <button class="action-btn danger-btn" onclick="renounceOwnership()">
                    RENOUNCE OWNERSHIP (PERMANENT)
                </button>
            </div>
            
            <div id="ownershipStatus"></div>
        </div>
    </div>

    <script>
        const CONTRACT_ADDRESS = '0xYourContractAddressHere'; // <<< UPDATE THIS
        
        const CONTRACT_ABI = [{"type":"constructor","inputs":[],"stateMutability":"nonpayable"},{"name":"AirdropExecuted","type":"event","inputs":[{"name":"recipients","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"totalAmount","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"name":"Approval","type":"event","inputs":[{"name":"owner","type":"address","indexed":true,"internalType":"address"},{"name":"spender","type":"address","indexed":true,"internalType":"address"},{"name":"v","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"name":"FeesUpdated","type":"event","inputs":[{"name":"","type":"uint16","indexed":false,"internalType":"uint16"},{"name":"","type":"uint16","indexed":false,"internalType":"uint16"},{"name":"","type":"uint16","indexed":false,"internalType":"uint16"},{"name":"","type":"uint16","indexed":false,"internalType":"uint16"}],"anonymous":false},{"name":"NoYieldSet","type":"event","inputs":[{"name":"","type":"address","indexed":true,"internalType":"address"},{"name":"","type":"bool","indexed":false,"internalType":"bool"}],"anonymous":false},{"name":"OwnershipTransferred","type":"event","inputs":[{"name":"prev","type":"address","indexed":true,"internalType":"address"},{"name":"next","type":"address","indexed":true,"internalType":"address"}],"anonymous":false},{"name":"PayoutPolicyUpdated","type":"event","inputs":[{"name":"","type":"bool","indexed":false,"internalType":"bool"},{"name":"","type":"uint24","indexed":false,"internalType":"uint24"},{"name":"","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"","type":"uint24","indexed":false,"internalType":"uint24"}],"anonymous":false},{"name":"SlippageUpdated","type":"event","inputs":[{"name":"","type":"uint16","indexed":false,"internalType":"uint16"}],"anonymous":false},{"name":"SwapExecuted","type":"event","inputs":[{"name":"ogtIn","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"rewardOut","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"slippage","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"name":"SwapParamsUpdated","type":"event","inputs":[{"name":"","type":"bool","indexed":false,"internalType":"bool"},{"name":"","type":"uint24","indexed":false,"internalType":"uint24"}],"anonymous":false},{"name":"Transfer","type":"event","inputs":[{"name":"from","type":"address","indexed":true,"internalType":"address"},{"name":"to","type":"address","indexed":true,"internalType":"address"},{"name":"v","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"name":"YieldPaid","type":"event","inputs":[{"name":"wallet","type":"address","indexed":true,"internalType":"address"},{"name":"rewardAmount","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"name":"owner","type":"function","inputs":[],"outputs":[{"name":"","type":"address","internalType":"address"}],"stateMutability":"view"},{"name":"payoutEnabled","type":"function","inputs":[],"outputs":[{"name":"","type":"bool","internalType":"bool"}],"stateMutability":"view"},{"name":"minWaitSec","type":"function","inputs":[],"outputs":[{"name":"","type":"uint24","internalType":"uint24"}],"stateMutability":"view"},{"name":"minYield","type":"function","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"name":"maxPayout","type":"function","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"name":"maxGas","type":"function","inputs":[],"outputs":[{"name":"","type":"uint24","internalType":"uint24"}],"stateMutability":"view"},{"name":"swapEnabled","type":"function","inputs":[],"outputs":[{"name":"","type":"bool","internalType":"bool"}],"stateMutability":"view"},{"name":"lpFactor","type":"function","inputs":[],"outputs":[{"name":"","type":"uint24","internalType":"uint24"}],"stateMutability":"view"},{"name":"slippageBips","type":"function","inputs":[],"outputs":[{"name":"","type":"uint16","internalType":"uint16"}],"stateMutability":"view"},{"name":"autoPayout","type":"function","inputs":[],"outputs":[{"name":"","type":"bool","internalType":"bool"}],"stateMutability":"view"},{"name":"fees","type":"function","inputs":[{"name":"","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"","type":"uint16","internalType":"uint16"}],"stateMutability":"view"},{"name":"setFees","type":"function","inputs":[{"name":"bb","type":"uint16","internalType":"uint16"},{"name":"by","type":"uint16","internalType":"uint16"},{"name":"sb","type":"uint16","internalType":"uint16"},{"name":"sy","type":"uint16","internalType":"uint16"}],"outputs":[],"stateMutability":"nonpayable"},{"name":"setPayoutPolicy","type":"function","inputs":[{"name":"en","type":"bool","internalType":"bool"},{"name":"minDur","type":"uint24","internalType":"uint24"},{"name":"newMin","type":"uint256","internalType":"uint256"},{"name":"newMax","type":"uint256","internalType":"uint256"},{"name":"gas_","type":"uint24","internalType":"uint24"}],"outputs":[],"stateMutability":"nonpayable"},{"name":"setSwapParams","type":"function","inputs":[{"name":"en","type":"bool","internalType":"bool"},{"name":"f","type":"uint24","internalType":"uint24"}],"outputs":[],"stateMutability":"nonpayable"},{"name":"setSlippage","type":"function","inputs":[{"name":"slippage","type":"uint16","internalType":"uint16"}],"outputs":[],"stateMutability":"nonpayable"},{"name":"setAutoPayout","type":"function","inputs":[{"name":"en","type":"bool","internalType":"bool"}],"outputs":[],"stateMutability":"nonpayable"},{"name":"setNoYield","type":"function","inputs":[{"name":"w","type":"address","internalType":"address"},{"name":"f","type":"bool","internalType":"bool"}],"outputs":[],"stateMutability":"nonpayable"},{"name":"transferOwnership","type":"function","inputs":[{"name":"newOwner","type":"address","internalType":"address"}],"outputs":[],"stateMutability":"nonpayable"},{"name":"renounceOwnership","type":"function","inputs":[],"outputs":[],"stateMutability":"nonpayable"}];

        let provider;
        let signer;
        let contract;
        let userAddress;

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showStatus('ownershipStatus', 'Please install a Web3 wallet (MetaMask, Rabby, etc.)', 'error');
                return;
            }

            try {
                // Request account access
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (!accounts || accounts.length === 0) {
                    throw new Error('No accounts found');
                }
                
                userAddress = accounts[0];
                
                // Create provider and signer
                provider = new ethers.providers.Web3Provider(window.ethereum, "any");
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                
                // Verify we're on PulseChain (chain ID 369)
                const network = await provider.getNetwork();
                if (network.chainId !== 369) {
                    const shouldSwitch = confirm('Wrong network detected. Switch to PulseChain?');
                    if (shouldSwitch) {
                        await switchToPulseChain();
                        // Reload to reconnect on correct network
                        location.reload();
                        return;
                    } else {
                        showStatus('ownershipStatus', 'Please switch to PulseChain network (Chain ID: 369)', 'error');
                        return;
                    }
                }
                
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                document.getElementById('walletAddress').textContent = 
                    userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
                
                document.getElementById('connectBtn').textContent = 'Connected ‚úì';
                document.getElementById('connectBtn').disabled = true;

                await loadContractData();
                
                showStatus('ownershipStatus', 'Wallet connected successfully on PulseChain!', 'success');
            } catch (error) {
                console.error(error);
                if (error.code === 4001) {
                    showStatus('ownershipStatus', 'Connection rejected by user', 'error');
                } else if (error.code === -32002) {
                    showStatus('ownershipStatus', 'Connection request pending - check your wallet', 'info');
                } else {
                    showStatus('ownershipStatus', 'Failed to connect: ' + error.message, 'error');
                }
            }
        }

        async function loadContractData() {
            try {
                const owner = await contract.owner();
                document.getElementById('contractOwner').textContent = 
                    owner.slice(0, 6) + '...' + owner.slice(-4);

                // Load current fees
                const buyBurn = await contract.fees(0);
                const buyYield = await contract.fees(1);
                const sellBurn = await contract.fees(2);
                const sellYield = await contract.fees(3);
                
                document.getElementById('currentBuyBurn').textContent = buyBurn + ' bps (' + (buyBurn/100).toFixed(2) + '%)';
                document.getElementById('currentBuyYield').textContent = buyYield + ' bps (' + (buyYield/100).toFixed(2) + '%)';
                document.getElementById('currentSellBurn').textContent = sellBurn + ' bps (' + (sellBurn/100).toFixed(2) + '%)';
                document.getElementById('currentSellYield').textContent = sellYield + ' bps (' + (sellYield/100).toFixed(2) + '%)';

                // Load payout policy
                const payoutEnabled = await contract.payoutEnabled();
                const minWaitSec = await contract.minWaitSec();
                const minYield = await contract.minYield();
                const maxPayout = await contract.maxPayout();
                const maxGas = await contract.maxGas();

                document.getElementById('currentPayoutEnabled').textContent = payoutEnabled ? 'Yes' : 'No';
                document.getElementById('currentMinWait').textContent = minWaitSec + ' sec (' + (minWaitSec/3600).toFixed(1) + ' hrs)';
                document.getElementById('currentMinYield').textContent = ethers.utils.formatEther(minYield) + ' pSunDAI';
                document.getElementById('currentMaxPayout').textContent = ethers.utils.formatEther(maxPayout) + ' pSunDAI';
                document.getElementById('currentMaxGas').textContent = maxGas.toString();

                // Load swap config
                const swapEnabled = await contract.swapEnabled();
                const lpFactor = await contract.lpFactor();
                const slippageBips = await contract.slippageBips();
                const autoPayout = await contract.autoPayout();

                document.getElementById('currentSwapEnabled').textContent = swapEnabled ? 'Yes' : 'No';
                document.getElementById('currentLpFactor').textContent = lpFactor.toString();
                document.getElementById('currentSlippage').textContent = slippageBips + ' bps (' + (slippageBips/100).toFixed(2) + '%)';
                document.getElementById('currentAutoPayout').textContent = autoPayout ? 'Yes' : 'No';

            } catch (error) {
                console.error('Error loading contract data:', error);
            }
        }

        async function setFees() {
            const bb = parseInt(document.getElementById('buyBurnFee').value);
            const by = parseInt(document.getElementById('buyYieldFee').value);
            const sb = parseInt(document.getElementById('sellBurnFee').value);
            const sy = parseInt(document.getElementById('sellYieldFee').value);

            if (bb + by > 500 || sb + sy > 500) {
                showStatus('feesStatus', 'Total fees cannot exceed 5%!', 'error');
                return;
            }

            try {
                showStatus('feesStatus', 'Updating fees...', 'info');
                const tx = await contract.setFees(bb, by, sb, sy);
                await tx.wait();
                showStatus('feesStatus', 'Fees updated successfully!', 'success');
                await loadContractData();
            } catch (error) {
                showStatus('feesStatus', 'Error: ' + error.message, 'error');
            }
        }

        async function setPayoutPolicy() {
            const enabled = document.getElementById('payoutEnabled').checked;
            const minWait = parseInt(document.getElementById('minWaitSec').value);
            const minYieldValue = parseFloat(document.getElementById('minYield').value);
            const maxPayoutValue = parseFloat(document.getElementById('maxPayout').value);
            const gas = parseInt(document.getElementById('maxGas').value);

            const minYieldWei = ethers.utils.parseEther(minYieldValue.toString());
            const maxPayoutWei = ethers.utils.parseEther(maxPayoutValue.toString());

            try {
                showStatus('payoutStatus', 'Updating payout policy...', 'info');
                const tx = await contract.setPayoutPolicy(enabled, minWait, minYieldWei, maxPayoutWei, gas);
                await tx.wait();
                showStatus('payoutStatus', 'Payout policy updated successfully!', 'success');
                await loadContractData();
            } catch (error) {
                showStatus('payoutStatus', 'Error: ' + error.message, 'error');
            }
        }

        async function setSwapParams() {
            const enabled = document.getElementById('swapEnabled').checked;
            const factor = parseInt(document.getElementById('lpFactor').value);

            try {
                showStatus('swapStatus', 'Updating swap parameters...', 'info');
                const tx = await contract.setSwapParams(enabled, factor);
                await tx.wait();
                showStatus('swapStatus', 'Swap parameters updated successfully!', 'success');
                await loadContractData();
            } catch (error) {
                showStatus('swapStatus', 'Error: ' + error.message, 'error');
            }
        }

        async function setSlippage() {
            const slippage = parseInt(document.getElementById('slippage').value);

            try {
                showStatus('swapStatus', 'Updating slippage...', 'info');
                const tx = await contract.setSlippage(slippage);
                await tx.wait();
                showStatus('swapStatus', 'Slippage updated successfully!', 'success');
                await loadContractData();
            } catch (error) {
                showStatus('swapStatus', 'Error: ' + error.message, 'error');
            }
        }

        async function setAutoPayout() {
            const enabled = document.getElementById('autoPayout').checked;

            try {
                showStatus('swapStatus', 'Updating auto payout...', 'info');
                const tx = await contract.setAutoPayout(enabled);
                await tx.wait();
                showStatus('swapStatus', 'Auto payout updated successfully!', 'success');
                await loadContractData();
            } catch (error) {
                showStatus('swapStatus', 'Error: ' + error.message, 'error');
            }
        }

        async function setNoYield() {
            const address = document.getElementById('excludeAddress').value;
            const exclude = document.getElementById('excludeFlag').checked;

            if (!ethers.utils.isAddress(address)) {
                showStatus('excludeStatus', 'Invalid address!', 'error');
                return;
            }

            try {
                showStatus('excludeStatus', 'Updating yield exclusion...', 'info');
                const tx = await contract.setNoYield(address, exclude);
                await tx.wait();
                showStatus('excludeStatus', 'Yield exclusion updated successfully!', 'success');
            } catch (error) {
                showStatus('excludeStatus', 'Error: ' + error.message, 'error');
            }
        }

        async function transferOwnership() {
            const newOwner = document.getElementById('newOwner').value;

            if (!ethers.utils.isAddress(newOwner)) {
                showStatus('ownershipStatus', 'Invalid address!', 'error');
                return;
            }

            if (!confirm('Are you sure you want to transfer ownership to ' + newOwner + '?')) {
                return;
            }

            try {
                showStatus('ownershipStatus', 'Transferring ownership...', 'info');
                const tx = await contract.transferOwnership(newOwner);
                await tx.wait();
                showStatus('ownershipStatus', 'Ownership transferred successfully!', 'success');
                await loadContractData();
            } catch (error) {
                showStatus('ownershipStatus', 'Error: ' + error.message, 'error');
            }
        }

        async function renounceOwnership() {
            const confirmed = confirm(
                '‚ö†Ô∏è WARNING: This action is PERMANENT and IRREVERSIBLE!\n\n' +
                'You will lose ALL control over the contract forever.\n\n' +
                'Are you ABSOLUTELY SURE you want to renounce ownership?'
            );

            if (!confirmed) return;

            const doubleConfirm = confirm(
                'FINAL CONFIRMATION:\n\n' +
                'Type "yes" in the next prompt to renounce ownership.\n\n' +
                'Click OK to continue.'
            );

            if (!doubleConfirm) return;

            const finalCheck = prompt('Type "RENOUNCE" (all caps) to confirm:');
            
            if (finalCheck !== 'RENOUNCE') {
                showStatus('ownershipStatus', 'Renunciation cancelled.', 'info');
                return;
            }

            try {
                showStatus('ownershipStatus', 'Renouncing ownership...', 'info');
                const tx = await contract.renounceOwnership();
                await tx.wait();
                showStatus('ownershipStatus', '‚úÖ Ownership renounced! Contract is now immutable.', 'success');
                await loadContractData();
            } catch (error) {
                showStatus('ownershipStatus', 'Error: ' + error.message, 'error');
            }
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status-message ${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 5000);
        }

        // Auto-connect if previously connected
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        await connectWallet();
                    }
                } catch (error) {
                    console.error('Auto-connect failed:', error);
                }
                
                // Handle account changes
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length === 0) {
                        location.reload();
                    } else {
                        location.reload();
                    }
                });
                
                // Handle chain changes
                window.ethereum.on('chainChanged', () => {
                    location.reload();
                });
            }
        });
        
        // Helper function to switch to PulseChain
        async function switchToPulseChain() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x171' }], // 369 in hex
                });
            } catch (switchError) {
                // Chain not added, try to add it
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x171',
                                chainName: 'PulseChain',
                                nativeCurrency: {
                                    name: 'Pulse',
                                    symbol: 'PLS',
                                    decimals: 18
                                },
                                rpcUrls: ['https://rpc.pulsechain.com'],
                                blockExplorerUrls: ['https://scan.pulsechain.com']
                            }]
                        });
                    } catch (addError) {
                        throw new Error('Failed to add PulseChain network');
                    }
                }
            }
        }
    </script>
</body>
</html>
