<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá∫üá∏ Old Glory RISE - pSunDAI Rewards üá∫üá∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        :root {
            --navy: #0a1628;
            --red: #c41e3a;
            --white: #ffffff;
            --blue: #002868;
            --silver: #c0c0c0;
            --gold: #d4af37;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, var(--navy) 0%, #0d1b2a 50%, var(--blue) 100%);
            color: var(--white);
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.03) 2px, rgba(255,255,255,0.03) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,0.03) 2px, rgba(255,255,255,0.03) 4px);
            pointer-events: none;
            z-index: 1;
        }

        .stars {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            width: 2px; height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            padding: 3rem 0 2rem;
        }

        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .flag {
            font-size: 4rem;
            line-height: 1;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: linear-gradient(135deg, var(--white) 0%, var(--silver) 50%, var(--white) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
            line-height: 1;
        }

        @keyframes shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .tagline {
            font-size: 1.3rem;
            font-weight: 300;
            letter-spacing: 0.15em;
            color: var(--silver);
            text-transform: uppercase;
            margin-bottom: 2rem;
        }

        .contract-display {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(184, 134, 11, 0.3) 100%);
            border: 2px solid var(--gold);
            padding: 1.5rem;
            margin: 2rem auto;
            max-width: 800px;
            border-radius: 8px;
        }

        .contract-display h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--gold);
            text-transform: uppercase;
        }

        .contract-address {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            color: var(--white);
            background: rgba(0,0,0,0.4);
            padding: 1rem;
            border-radius: 4px;
            word-break: break-all;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .contract-address:hover {
            background: rgba(0,0,0,0.6);
            border-color: var(--gold);
        }

        .connect-btn {
            background: linear-gradient(135deg, var(--red) 0%, #8b0000 100%);
            color: white;
            border: 2px solid var(--gold);
            padding: 1rem 3rem;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Cinzel', serif;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
        }

        .status {
            margin: 1rem 0;
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0, 40, 104, 0.3) 0%, rgba(10, 22, 40, 0.5) 100%);
            border: 2px solid rgba(192, 192, 192, 0.3);
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--gold);
        }

        .stat-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--silver);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Cinzel', serif;
            color: var(--gold);
        }

        .stat-subtext {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
        }

        .claim-section {
            background: linear-gradient(135deg, rgba(196, 30, 58, 0.2) 0%, rgba(139, 0, 0, 0.3) 100%);
            border: 3px solid var(--red);
            padding: 3rem;
            margin: 3rem 0;
        }

        .claim-btn {
            display: block;
            width: 100%;
            max-width: 500px;
            margin: 2rem auto;
            background: linear-gradient(135deg, var(--gold) 0%, #b8860b 100%);
            color: var(--navy);
            border: 3px solid var(--white);
            padding: 1.5rem;
            font-size: 1.5rem;
            font-weight: 900;
            font-family: 'Cinzel', serif;
            text-transform: uppercase;
            cursor: pointer;
        }

        .claim-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 1rem;
            border-radius: 4px;
        }

        .success {
            color: #51cf66;
            background: rgba(81, 207, 102, 0.1);
            padding: 1rem;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .title-container { flex-direction: column; gap: 0.5rem; }
            .flag { font-size: 3rem; }
            h1 { font-size: 2.5rem; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <header>
            <div class="title-container">
                <span class="flag">üá∫üá∏</span>
                <h1>Old Glory RISE</h1>
                <span class="flag">üá∫üá∏</span>
            </div>
            <p class="tagline">V10 ‚Ä¢ pSunDAI Rewards ‚Ä¢ Autonomous</p>
            
            <div class="contract-display">
                <h3>üìú RISE Contract (Click to Copy)</h3>
                <div class="contract-address" onclick="copyContract()">
                    0x555679515BBF858290670d6a57543B0e4E09E89B
                </div>
            </div>
            
            <button class="connect-btn" id="connectBtn">Connect Wallet</button>
            <div class="status" id="status">Connect to PulseChain</div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Supply</div>
                <div class="stat-value" id="totalSupply">--</div>
                <div class="stat-subtext">RISE Tokens</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Burned</div>
                <div class="stat-value" id="totalBurned">--</div>
                <div class="stat-subtext">Sent to 0x369</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">pSunDAI Paid</div>
                <div class="stat-value" id="totalPaid">--</div>
                <div class="stat-subtext">Total Rewards</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Your Balance</div>
                <div class="stat-value" id="userBalance">--</div>
                <div class="stat-subtext">RISE</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Your Shares</div>
                <div class="stat-value" id="userShares">--</div>
                <div class="stat-subtext">With 2x LP Bonus</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Pending Yield</div>
                <div class="stat-value" id="unpaidYield">--</div>
                <div class="stat-subtext">pSunDAI Ready</div>
            </div>
        </div>

        <div style="text-align: center; color: var(--silver); margin: 2rem 0; font-size: 1.1rem;" id="claimHint">
            üéÅ Connect wallet to see claim section
        </div>

        <div class="claim-section" id="claimSection" style="display: none;">
            <h2 style="font-family: 'Cinzel', serif; text-align: center; font-size: 2rem; margin-bottom: 2rem;">
                üéÅ CLAIM YOUR PSUNDAI üéÅ
            </h2>
            <div id="countdown" style="text-align: center; font-size: 1.2rem; margin-bottom: 1rem;">
                üí∞ Minimum: 0.369 pSunDAI
            </div>
            <button class="claim-btn" id="claimBtn" onclick="claimYield()" disabled>
                CLAIM PSUNDAI NOW
            </button>
            <div id="claimStatus"></div>
        </div>
    </div>

    <script>
        const CONTRACT_ADDRESS = '0x555679515BBF858290670d6a57543B0e4E09E89B';
        const PSUNDAI_ADDRESS = '0x5529c1cb179b2c256501031adCDAfC22D9c6d236';
        const LP_ADDRESS = '0x3bC0CF435A8A2A18044505a1A9c6272B854338AB';
        const BURN_ADDRESS = '0x0000000000000000000000000000000000000369';
        const PULSECHAIN_ID = 369;
        
        // V10 (CST V6 Pattern) ABI
        const CONTRACT_ABI = [
            "function totalSupply() view returns (uint256)",
            "function balanceOf(address) view returns (uint256)",
            "function getUnpaidYield(address wallet, address token) view returns (uint256)",
            "function walletInfo(address) view returns (uint256 share)",
            "function rewardTokens(address) view returns (address token, uint8 decimals, uint256 scale, uint256 shareYieldRay, uint256 totalPaid, uint256 totalYield)",
            "function walletClaimTS(address, address) view returns (uint256)",
            "function minWaitSec() view returns (uint24)",
            "function minYield() view returns (uint256)",
            "function claimYield()",
            "function plsV2LP() view returns (address)"
        ];

        let provider, signer, contract, userAddress;

        function generateStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        function copyContract() {
            navigator.clipboard.writeText(CONTRACT_ADDRESS);
            alert('‚úÖ Copied!');
        }

        function formatNumber(num, decimals = 2) {
            if (!num) return '0';
            const n = parseFloat(num);
            if (n >= 1e6) return (n / 1e6).toFixed(decimals) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(decimals) + 'K';
            return n.toFixed(decimals);
        }

        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('Install MetaMask!');
                    return;
                }

                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                
                const network = await provider.getNetwork();
                if (network.chainId !== PULSECHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x171' }],
                        });
                    } catch (e) {
                        if (e.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0x171',
                                    chainName: 'PulseChain',
                                    nativeCurrency: { name: 'PLS', symbol: 'PLS', decimals: 18 },
                                    rpcUrls: ['https://rpc.pulsechain.com'],
                                    blockExplorerUrls: ['https://scan.pulsechain.com']
                                }]
                            });
                        }
                    }
                }

                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                document.getElementById('connectBtn').textContent = userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('status').textContent = '‚úÖ Connected';

                await loadData();
                setInterval(loadData, 15000);
                
            } catch (error) {
                document.getElementById('status').innerHTML = '<div class="error">' + error.message + '</div>';
            }
        }

        async function loadData() {
            try {
                // Total supply
                const supply = await contract.totalSupply();
                document.getElementById('totalSupply').textContent = formatNumber(ethers.utils.formatEther(supply), 0);
                
                // Burned
                const burned = await contract.balanceOf(BURN_ADDRESS);
                document.getElementById('totalBurned').textContent = formatNumber(ethers.utils.formatEther(burned), 0);
                
                // Total paid (from rewardTokens mapping)
                const rewardInfo = await contract.rewardTokens(PSUNDAI_ADDRESS);
                document.getElementById('totalPaid').textContent = formatNumber(ethers.utils.formatEther(rewardInfo.totalPaid), 2);

                if (userAddress) await loadUserData();
            } catch (error) {
                console.error('Load error:', error);
            }
        }

        async function loadUserData() {
            try {
                const balance = await contract.balanceOf(userAddress);
                
                // walletInfo might return struct or just uint256
                let share;
                try {
                    const walletInfo = await contract.walletInfo(userAddress);
                    // Try as struct first
                    share = walletInfo.share || walletInfo[0] || walletInfo;
                } catch (e) {
                    console.error('walletInfo error:', e);
                    share = ethers.BigNumber.from(0);
                }
                
                console.log('Share:', share.toString());
                
                const unpaid = await contract.getUnpaidYield(userAddress, PSUNDAI_ADDRESS);
                const lastClaim = await contract.walletClaimTS(userAddress, PSUNDAI_ADDRESS);
                const minWait = await contract.minWaitSec();
                const minYieldAmt = await contract.minYield();

                const lpContract = new ethers.Contract(LP_ADDRESS, ['function balanceOf(address) view returns (uint256)'], provider);
                const lpBal = await lpContract.balanceOf(userAddress);

                document.getElementById('userBalance').textContent = formatNumber(ethers.utils.formatEther(balance), 2);
                document.getElementById('userShares').textContent = formatNumber(ethers.utils.formatEther(share), 0);
                
                const unpaidAmt = parseFloat(ethers.utils.formatEther(unpaid));
                document.getElementById('unpaidYield').textContent = formatNumber(unpaidAmt, 4);

                const now = Math.floor(Date.now() / 1000);
                const lastClaimNum = parseInt(lastClaim.toString());
                const minWaitNum = parseInt(minWait.toString());
                const minRequired = parseFloat(ethers.utils.formatEther(minYieldAmt));
                
                const nextClaim = lastClaimNum + minWaitNum;
                const canClaim = now >= nextClaim && unpaidAmt >= minRequired;
                
                document.getElementById('claimBtn').disabled = !canClaim;
                
                if (canClaim) {
                    document.getElementById('countdown').innerHTML = '‚úÖ <strong style="color: #51cf66;">READY!</strong><br>' + unpaidAmt.toFixed(4) + ' pSunDAI';
                    document.getElementById('claimBtn').textContent = 'üéÅ CLAIM ' + unpaidAmt.toFixed(4) + ' PSUNDAI';
                } else if (unpaidAmt < minRequired) {
                    document.getElementById('countdown').innerHTML = '‚è≥ Need ' + minRequired.toFixed(3) + '<br>Current: ' + unpaidAmt.toFixed(4);
                } else {
                    const wait = nextClaim - now;
                    const hrs = Math.floor(wait / 3600);
                    const mins = Math.floor((wait % 3600) / 60);
                    document.getElementById('countdown').innerHTML = '‚è∞ Wait: ' + (hrs > 0 ? hrs + 'h ' : '') + mins + 'm<br>' + unpaidAmt.toFixed(4) + ' ready';
                }

                document.getElementById('claimSection').style.display = 'block';
                document.getElementById('claimHint').style.display = 'none';
            } catch (error) {
                console.error('User data error:', error);
            }
        }

        async function claimYield() {
            try {
                document.getElementById('claimBtn').disabled = true;
                document.getElementById('claimBtn').textContent = '‚è≥ CLAIMING...';
                document.getElementById('claimStatus').innerHTML = '<div class="status">Sending...</div>';
                
                const tx = await contract.claimYield();
                document.getElementById('claimStatus').innerHTML = '<div class="status">‚è≥ Confirming...</div>';
                
                await tx.wait();
                
                document.getElementById('claimStatus').innerHTML = '<div class="success">‚úÖ Success!</div>';
                
                setTimeout(() => {
                    document.getElementById('claimStatus').innerHTML = '';
                    loadUserData();
                }, 5000);
                
            } catch (error) {
                document.getElementById('claimStatus').innerHTML = '<div class="error">‚ùå ' + error.message + '</div>';
                document.getElementById('claimBtn').disabled = false;
                document.getElementById('claimBtn').textContent = 'üéÅ CLAIM PSUNDAI';
            }
        }

        window.addEventListener('load', () => {
            generateStars();
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            if (window.ethereum && window.ethereum.selectedAddress) connectWallet();
        });
    </script>
</body>
</html>
